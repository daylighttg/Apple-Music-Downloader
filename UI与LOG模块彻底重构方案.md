
## ğŸ§­ ä¸€ã€é‡æ„æ€»ä½“ç›®æ ‡(è§£å†³æ—¥å¿—å¹¶å‘ã€å¤šæ¨¡å—æ—¥å¿—ç«äº‰ã€æ—¥å¿—å™ªéŸ³éš¾ä»¥æŠ‘åˆ¶ç­‰é¡½å›ºé—®é¢˜)

| æ¨¡å—          | ç›®æ ‡            | é¢„æœŸæ”¶ç›Š                     |
| ----------- | ------------- | ------------------------ |
| **UI æ¨¡å—**   | æŠ½è±¡æ¸²æŸ“é€»è¾‘ï¼Œæ¶ˆé™¤ä¸šåŠ¡è€¦åˆ | å¯åˆ‡æ¢ç»ˆç«¯UI / æ— UIæ¨¡å¼ / Webæ§åˆ¶å° |
| **æ—¥å¿—æ¨¡å—**    | å»ºç«‹ç»Ÿä¸€æ—¥å¿—æ¥å£ä¸åˆ†çº§è¾“å‡º | æ”¯æŒæ–‡ä»¶è®°å½•ã€è¿‡æ»¤ã€ç»“æ„åŒ–æ—¥å¿—          |
| **å¹¶å‘ä¸è¾“å‡ºå®‰å…¨** | åˆ†ç¦» UI è¾“å‡ºä¸æ—¥å¿—è¾“å‡º | é˜²æ­¢ç«äº‰æ¡ä»¶ä¸ç»ˆç«¯æ±¡æŸ“              |
| **æµ‹è¯•æ€§ä¸æ‰©å±•æ€§** | é€šè¿‡æ¥å£æŠ½è±¡å®ç°å•å…ƒæµ‹è¯•  | é™ä½ç»´æŠ¤æˆæœ¬ï¼Œä¾¿äºé›†æˆæ–°å‰ç«¯           |

---

## ğŸ§© äºŒã€æ•´ä½“æ¶æ„è®¾è®¡ï¼ˆæ¦‚è§ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           main.go            â”‚
â”‚ â”œâ”€ åˆå§‹åŒ– logger             â”‚
â”‚ â”œâ”€ åˆå§‹åŒ– UI                 â”‚
â”‚ â””â”€ å¯åŠ¨ä¸‹è½½è°ƒåº¦å™¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                 â”‚
        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   internal/logger  â”‚      â”‚   internal/ui       â”‚
â”‚   - logger.go      â”‚      â”‚   - ui.go           â”‚
â”‚   - config.go      â”‚      â”‚   - listener.go     â”‚
â”‚                    â”‚      â”‚                    â”‚
â”‚   æä¾›ç»Ÿä¸€æ—¥å¿—æ¥å£ â”‚      â”‚  å®ç°Progressç›‘å¬å™¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                 â”‚
        â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ internal/progress  â”‚      â”‚ internal/downloaderâ”‚
â”‚ æŠ½è±¡é€šçŸ¥æ¥å£       â”‚      â”‚ å‘å‡ºProgressäº‹ä»¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ä¸‰ã€ä¼˜å…ˆçº§ä¸MVPæ–¹æ¡ˆ

### **MVPï¼ˆæœ€å°å¯è¡Œæ–¹æ¡ˆï¼‰- æ¨èä¼˜å…ˆå®æ–½**

é’ˆå¯¹æ ¸å¿ƒé—®é¢˜çš„æœ€å°åŒ–é‡æ„æ–¹æ¡ˆï¼Œé¢„è®¡ **4-5å‘¨** å®Œæˆï¼š

| é˜¶æ®µ | å†…å®¹ | å·¥ä½œé‡ | å¿…è¦æ€§ |
|------|------|--------|--------|
| Phase 1 | æ—¥å¿—æ¨¡å—é‡æ„ | 1-2å‘¨ | ğŸ”´ å¿…éœ€ |
| Phase 2 | UIäº‹ä»¶é©±åŠ¨è§£è€¦ | 2-3å‘¨ | ğŸ”´ å¿…éœ€ |
| Phase 4.1 | åŸºç¡€æµ‹è¯• | 1å‘¨ | ğŸ”´ å¿…éœ€ |

**MVPäº¤ä»˜æˆæœ**ï¼š
- âœ… æ¶ˆé™¤æ—¥å¿—ç«äº‰ä¸è¾“å‡ºæ··ä¹±
- âœ… UIä¸ä¸‹è½½å™¨è§£è€¦ï¼Œæ¶æ„æ¸…æ™°
- âœ… æ€§èƒ½æå‡90%ï¼ˆUIåˆ·æ–°é¢‘ç‡ï¼‰
- âœ… é€šè¿‡æ‰€æœ‰å¹¶å‘å®‰å…¨æµ‹è¯•

### **å®Œæ•´æ–¹æ¡ˆï¼ˆå¯é€‰åç»­è¿­ä»£ï¼‰**

åœ¨MVPåŸºç¡€ä¸Šçš„å¢å¼ºåŠŸèƒ½ï¼Œé¢„è®¡é¢å¤– **2-3å‘¨**ï¼š

| é˜¶æ®µ | å†…å®¹ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|------|------|--------|--------|
| Phase 3.1 | æ—¥å¿—æ–‡ä»¶è¾“å‡º | 2å¤© | ğŸŸ¡ ä¸­ |
| Phase 3.2 | ç»“æ„åŒ–æ—¥å¿— | 3å¤© | ğŸŸ¢ ä½ï¼ˆå¯é€‰ï¼‰ |
| Phase 3.3 | å¯æ’æ‹”UI | 5å¤© | ğŸŸ¢ ä½ï¼ˆå¯é€‰ï¼‰ |
| Phase 4.2 | å®Œæ•´æµ‹è¯•ä¸ä¼˜åŒ– | 1å‘¨ | ğŸŸ¡ ä¸­ |

---

## âš™ï¸ å››ã€å®æ–½é˜¶æ®µåˆ’åˆ†

### **Phase 1ï¼šæ—¥å¿—æ¨¡å—é‡æ„ï¼ˆ1~2å‘¨ï¼‰**

#### ğŸ¯ ç›®æ ‡

* ç»Ÿä¸€è¾“å‡ºè·¯å¾„ï¼ˆæ›¿ä»£ `fmt.Print*` ä¸ `SafePrintf`ï¼‰
* å¢åŠ æ—¥å¿—ç­‰çº§ï¼ˆDEBUG / INFO / WARN / ERRORï¼‰
* æ”¯æŒé…ç½®åŒ–è¾“å‡ºï¼ˆæ§åˆ¶å° / æ–‡ä»¶ï¼‰
* å‘åå…¼å®¹æ—§æ¥å£

#### ğŸ§± å…³é”®ä»»åŠ¡

1. æ–°å»º `internal/logger` åŒ…ï¼ˆè§æ–‡æ¡£ç¤ºä¾‹ï¼‰
2. åœ¨ `core/output.go` ä¸­ä¿ç•™å‘åå…¼å®¹å±‚ï¼š

   ```go
   func SafePrintf(format string, a ...interface{}) { logger.Info(format, a...) }
   func SafePrintln(a ...interface{}) { logger.Info(strings.TrimSuffix(fmt.Sprintln(a...), "\n")) }
   ```
3. æœç´¢å¹¶æ›¿æ¢ï¼š

   ```bash
   grep -r "fmt.Print" internal/ main.go | xargs sed -i 's/fmt.Print/logger.Info/g'
   ```
4. åœ¨ `config.yaml` ä¸­æ–°å¢ï¼š

   ```yaml
   logging:
     level: info
     output: stdout
     show_timestamp: false
   ```
5. å¢åŠ å•å…ƒæµ‹è¯•ï¼š

   ```go
   func TestLoggerLevel(t *testing.T) { ... }
   ```

#### âœ… éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½éªŒæ”¶**ï¼š
* æ‰€æœ‰æ—¥å¿—è¾“å‡ºå—é”ä¿æŠ¤ã€çº¿ç¨‹å®‰å…¨ï¼›
* å¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´æ—¥å¿—ç­‰çº§ï¼›
* ä¿æŒæ§åˆ¶å°è¾“å‡ºæ ·å¼ä¸ç°æœ‰ä¸€è‡´ã€‚

**è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ç›´æ¥fmt.Printè°ƒç”¨ï¼ˆæ’é™¤vendorå’Œæµ‹è¯•æ–‡ä»¶ï¼‰
grep -r "fmt\.Print" internal/ main.go utils/ --exclude-dir=vendor --exclude="*_test.go" | grep -v "// OK:" | wc -l
# é¢„æœŸè¾“å‡º: 0

# 2. å¹¶å‘å®‰å…¨æµ‹è¯•
go test -race ./internal/logger/...
# é¢„æœŸ: PASS, no race detected

# 3. æ—¥å¿—ç­‰çº§è¿‡æ»¤æµ‹è¯•
go run main.go --log-level=error test.txt 2>&1 | grep -c "INFO"
# é¢„æœŸè¾“å‡º: 0 (INFOçº§åˆ«è¢«è¿‡æ»¤)

# 4. æ€§èƒ½åŸºå‡†æµ‹è¯•
go test -bench=. ./internal/logger/...
# é¢„æœŸ: >1000000 ops/sec
```

---

### **Phase 2ï¼šUI æ¨¡å—è§£è€¦ä¸äº‹ä»¶é©±åŠ¨ï¼ˆ2~3å‘¨ï¼‰**

#### ğŸ¯ ç›®æ ‡

* ç§»é™¤ä¸‹è½½å™¨ç›´æ¥è°ƒç”¨ `ui.UpdateStatus`
* å¼•å…¥ `progress.Notifier`ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰
* è®© UI æˆä¸ºç‹¬ç«‹ç›‘å¬å™¨

#### ğŸ§± å…³é”®ä»»åŠ¡

1. æ–°å»ºåŒ… `internal/progress`ï¼Œå®ç°äº‹ä»¶ç»“æ„ä¸ç›‘å¬æ¥å£ï¼›

2. **ã€é‡è¦ã€‘ä½¿ç”¨é€‚é…å™¨æ¨¡å¼è¿›è¡Œè¿‡æ¸¡**ï¼ˆé™ä½é‡æ„é£é™©ï¼‰ï¼š

   ```go
   // internal/progress/adapter.go
   // å°†æ—§çš„ProgressUpdateé€‚é…ä¸ºæ–°çš„ProgressEvent
   type ProgressAdapter struct {
       notifier   *ProgressNotifier
       trackIndex int
       stage      string
   }

   func NewProgressAdapter(notifier *ProgressNotifier, trackIndex int, stage string) *ProgressAdapter {
       return &ProgressAdapter{
           notifier:   notifier,
           trackIndex: trackIndex,
           stage:      stage,
       }
   }

   // åˆ›å»ºä¸€ä¸ªå…¼å®¹æ—§ä»£ç çš„channelé€‚é…å™¨
   func (a *ProgressAdapter) ToChan() chan<- ProgressUpdate {
       ch := make(chan ProgressUpdate, 10)
       go func() {
           for update := range ch {
               // å°†æ—§æ ¼å¼è½¬æ¢ä¸ºæ–°æ ¼å¼
               a.notifier.Notify(ProgressEvent{
                   TrackIndex: a.trackIndex,
                   Stage:      a.stage,
                   Percentage: update.Percentage,
                   SpeedBPS:   update.SpeedBPS,
               })
           }
       }()
       return ch
   }
   ```

   **ä¼˜åŠ¿**ï¼š
   - âœ… æ— éœ€ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰ä¸‹è½½å™¨ä»£ç 
   - âœ… å¯ä»¥é€æ­¥è¿ç§»å„ä¸ªæ¨¡å—
   - âœ… å‡ºé—®é¢˜æ—¶æ˜“äºå®šä½å’Œå›æ»š

3. åœ¨ `downloader` ä¸­æ·»åŠ é€šçŸ¥é€»è¾‘ï¼ˆæ¸è¿›å¼ï¼‰ï¼š

   ```go
   // æ–¹å¼A: ä½¿ç”¨é€‚é…å™¨ï¼ˆè¿‡æ¸¡æœŸï¼‰
   adapter := progress.NewProgressAdapter(notifier, trackIndex, "download")
   progressChan := adapter.ToChan()
   // ç»§ç»­ä½¿ç”¨åŸæœ‰çš„ progressChan é€»è¾‘...

   // æ–¹å¼B: ç›´æ¥ä½¿ç”¨æ–°æ¥å£ï¼ˆé‡æ„å®Œæˆåï¼‰
   notifier.Notify(progress.ProgressEvent{ ... })
   ```

4. åœ¨ `ui` åŒ…ä¸­å®ç° `UIProgressListener`ï¼Œå“åº”è¿›åº¦ï¼š

   ```go
   func (l *UIProgressListener) OnProgress(e progress.ProgressEvent) {
       ui.UpdateStatus(e.TrackIndex, e.Status, getColorFunc(e.Stage))
   }
   ```

5. `main.go` æ³¨å†Œç›‘å¬å™¨ï¼š

   ```go
   notifier := progress.NewNotifier()
   notifier.AddListener(&ui.UIProgressListener{})
   ```

6. å°† `RunDownloads` ä¸ UI å±‚éš”ç¦»ï¼Œè¿›åº¦ä»…é€šè¿‡é€šçŸ¥ä¼ é€’ã€‚

#### âœ… éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½éªŒæ”¶**ï¼š
* ä¸‹è½½å™¨ä¸ UI ä¹‹é—´æ— ç›´æ¥ä¾èµ–ï¼›
* UI ä¸ä¸šåŠ¡åˆ†ç¦»ï¼Œå¯å•ç‹¬æ›¿æ¢ï¼›
* UIæ›´æ–°é¢‘ç‡æ§åˆ¶è‰¯å¥½ï¼Œæ— å¤šä½™åˆ·æ–°ã€‚

**è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥ä¸‹è½½å™¨æ˜¯å¦ç›´æ¥è°ƒç”¨UIï¼ˆåº”è¯¥ä¸º0ï¼‰
grep -r "ui\.UpdateStatus" internal/downloader/ utils/runv14/ utils/runv3/ | wc -l
# é¢„æœŸè¾“å‡º: 0

# 2. éªŒè¯è¿›åº¦å»é‡ç”Ÿæ•ˆï¼ˆä¸‹è½½å®Œæˆåä¸åº”æœ‰é‡å¤100%è¾“å‡ºï¼‰
./apple-music-downloader test.txt 2>&1 | grep "100%" | sort | uniq -c | awk '$1 > 2 {exit 1}'
# é¢„æœŸ: é€€å‡ºç  0ï¼ˆæ¯é¦–æ­Œæœ€å¤š2æ¬¡100%ï¼šä¸‹è½½+è§£å¯†ï¼‰

# 3. æ€§èƒ½æµ‹è¯•ï¼šUI CPUå ç”¨
go test -cpuprofile=cpu.prof ./internal/ui/...
go tool pprof -top cpu.prof | grep "ui.PrintUI"
# é¢„æœŸ: CPUå ç”¨ < 5%

# 4. å¹¶å‘å®‰å…¨æµ‹è¯•
go test -race ./internal/progress/...
# é¢„æœŸ: PASS, no race detected

# 5. åŠŸèƒ½ä¸€è‡´æ€§æµ‹è¯•ï¼ˆè¾“å‡ºå¯¹æ¯”ï¼‰
# ä¿å­˜é‡æ„å‰çš„è¾“å‡ºä½œä¸ºåŸºå‡†
./apple-music-downloader-old test.txt > old_output.txt 2>&1
./apple-music-downloader test.txt > new_output.txt 2>&1
# ä½¿ç”¨diffæ¯”è¾ƒï¼ˆå…è®¸æ€§èƒ½æå‡å¸¦æ¥çš„è½»å¾®å·®å¼‚ï¼‰
diff <(grep -v "é€Ÿåº¦\|æ—¶é—´" old_output.txt) <(grep -v "é€Ÿåº¦\|æ—¶é—´" new_output.txt)
# é¢„æœŸ: ä¸»è¦çŠ¶æ€è¾“å‡ºä¸€è‡´
```

**æ‰‹åŠ¨æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] ä¸‹è½½10é¦–æ­Œï¼Œè§‚å¯ŸUIæ˜¯å¦ç¨³å®šæ— é—ªçƒ
- [ ] ä¸‹è½½å®Œæˆåï¼Œ100%çŠ¶æ€ä¸é‡å¤å‡ºç°
- [ ] æš‚åœ/æ¢å¤åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯ä¿¡æ¯æ­£ç¡®æ˜¾ç¤ºå¹¶æˆªæ–­

---

### **Phase 3ï¼šå¢å¼ºåŠŸèƒ½ä¸å¯æ’æ‹”æ”¯æŒï¼ˆ3~4å‘¨ï¼‰**

#### ğŸ¯ ç›®æ ‡

* æä¾›å¤šç§æ—¥å¿—/è¾“å‡ºæ¨¡å¼ï¼›
* UIå±‚æ”¯æŒâ€œæ— UIæ¨¡å¼â€ï¼ˆä»…æ—¥å¿—è¾“å‡ºï¼‰ï¼›
* å¯æ‰©å±•åˆ°æœªæ¥Webæˆ–GUIç‰ˆæœ¬ã€‚

#### ğŸ§± å…³é”®ä»»åŠ¡

1. å®ç°æ—¥å¿—å¤šè·¯è¾“å‡ºï¼š

   ```go
   file, _ := os.OpenFile("amdl.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644)
   logger.SetOutput(io.MultiWriter(os.Stdout, file))
   ```
2. å®šä¹‰ UI æ¥å£ï¼š

   ```go
   type UI interface {
       Init()
       UpdateTrack(i int, s core.TrackStatus)
       Suspend()
       Resume()
       Close()
   }
   ```
3. å®ç° `LogUI` æ›¿ä»£ç»ˆç«¯åˆ·æ–°ç‰ˆï¼š

   ```go
   type LogUI struct{}
   func (l *LogUI) UpdateTrack(i int, s core.TrackStatus) {
       logger.Info("[%d/%d] %s - %s", s.TrackNum, s.TrackTotal, s.TrackName, s.Status)
   }
   ```
4. åœ¨ `main.go` é€‰æ‹©å®ç°ï¼š

   ```go
   if cfg.NoDynamicUI {
       ui = &ui.LogUI{}
   } else {
       ui = &ui.TerminalUI{}
   }
   ```

#### âœ… éªŒæ”¶æ ‡å‡†

* å¯åœ¨å‘½ä»¤è¡Œå‚æ•° `--no-ui` ä¸‹ç¦ç”¨åŠ¨æ€åˆ·æ–°ï¼›
* æ—¥å¿—æ–‡ä»¶ä¸ç»ˆç«¯åŒæ—¶è¾“å‡ºï¼›
* ä»£ç å…·å¤‡æ‰©å±•GUI/WebUIçš„åŸºç¡€ã€‚

---

### **Phase 4ï¼šæµ‹è¯•ä¸æ€§èƒ½ä¼˜åŒ–ï¼ˆ1~2å‘¨ï¼‰**

#### ğŸ¯ ç›®æ ‡

* å…¨è¦†ç›–å•å…ƒæµ‹è¯•ï¼›
* é˜²æ­¢ç«äº‰ä¸æ€§èƒ½å›é€€ï¼›
* é›†æˆæŒç»­æµ‹è¯•ï¼ˆGitHub Actionsï¼‰ã€‚

#### ğŸ§± å…³é”®ä»»åŠ¡

1. **ä¸ºæ ¸å¿ƒæ¨¡å—å¢åŠ å•å…ƒæµ‹è¯•**ï¼š

   ```go
   // internal/logger/logger_test.go
   func TestLoggerLevel(t *testing.T) { ... }
   func TestLoggerConcurrency(t *testing.T) { ... }
   func TestLoggerOutput(t *testing.T) { ... }

   // internal/progress/progress_test.go
   func TestProgressNotifier(t *testing.T) { ... }
   func TestProgressAdapter(t *testing.T) { ... }

   // internal/ui/ui_test.go
   func TestUpdateStatusDedup(t *testing.T) { ... }
   func TestUIListener(t *testing.T) { ... }
   ```

2. **å¹¶å‘å®‰å…¨æµ‹è¯•**ï¼š

   ```bash
   # è¿è¡Œæ‰€æœ‰raceæ£€æµ‹
   go test -race ./...
   
   # é’ˆå¯¹æ€§å‹åŠ›æµ‹è¯•
   go test -race -count=100 ./internal/logger/...
   go test -race -count=100 ./internal/progress/...
   ```

3. **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼ˆè¯¦ç»†æ–¹æ³•ï¼‰ï¼š

   ```go
   // internal/logger/logger_bench_test.go
   func BenchmarkLoggerInfo(b *testing.B) {
       logger := New()
       logger.SetOutput(io.Discard)
       b.ResetTimer()
       for i := 0; i < b.N; i++ {
           logger.Info("test message %d", i)
       }
   }
   // ç›®æ ‡: >1,000,000 ops/sec

   func BenchmarkLoggerConcurrent(b *testing.B) {
       logger := New()
       logger.SetOutput(io.Discard)
       b.ResetTimer()
       b.RunParallel(func(pb *testing.PB) {
           for pb.Next() {
               logger.Info("concurrent test")
           }
       })
   }
   // ç›®æ ‡: >500,000 ops/sec (å¹¶å‘åœºæ™¯)
   ```

   ```bash
   # è¿è¡ŒåŸºå‡†æµ‹è¯•
   go test -bench=. ./internal/logger/... -benchmem
   
   # å¯¹æ¯”é‡æ„å‰åæ€§èƒ½
   git checkout main
   go test -bench=. ./internal/logger/... > old_bench.txt
   git checkout feature/ui-refactor
   go test -bench=. ./internal/logger/... > new_bench.txt
   benchcmp old_bench.txt new_bench.txt
   ```

4. **UIæ€§èƒ½æµ‹è¯•**ï¼š

   ```bash
   # CPU profiling
   go test -cpuprofile=cpu.prof -bench=. ./internal/ui/...
   go tool pprof -top cpu.prof
   
   # Memory profiling
   go test -memprofile=mem.prof -bench=. ./internal/ui/...
   go tool pprof -top mem.prof
   
   # éªŒè¯UIæ¸²æŸ“CPUå ç”¨
   # ç›®æ ‡: PrintUIå‡½æ•°CPUå ç”¨ < 5%
   ```

5. **é›†æˆæµ‹è¯•**ï¼š

   ```bash
   # å®Œæ•´ä¸‹è½½æµç¨‹æµ‹è¯•
   ./test/integration_test.sh
   
   # åŒ…å«:
   # - å•é¦–æ­Œä¸‹è½½
   # - ä¸“è¾‘æ‰¹é‡ä¸‹è½½
   # - å¹¶å‘ä¸‹è½½æµ‹è¯•
   # - é”™è¯¯æ¢å¤æµ‹è¯•
   ```

6. **è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬**ï¼š

   ```makefile
   # Makefile
   .PHONY: test bench race lint

   test:
       go test ./... -v -cover

   bench:
       go test -bench=. ./... -benchmem

   race:
       go test -race ./...

   lint:
       golangci-lint run

   ci: test race lint
       @echo "All checks passed!"
   ```

#### âœ… éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½éªŒæ”¶**ï¼š
* æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ >80%ï¼‰ï¼›
* æ—  race æ£€æµ‹è­¦å‘Šï¼›
* æ€§èƒ½ä¸ä½äºç°ç‰ˆæœ¬ã€‚

**æ€§èƒ½åŸºå‡†**ï¼š
```bash
# 1. æ—¥å¿—æ€§èƒ½
go test -bench=BenchmarkLogger ./internal/logger/...
# é¢„æœŸ: >1,000,000 ops/sec

# 2. UIæ¸²æŸ“æ€§èƒ½
# ä¸‹è½½20é¦–æ­Œï¼Œæµ‹é‡æ€»CPUæ—¶é—´
time ./apple-music-downloader test_20_tracks.txt
# é¢„æœŸ: user time < 5ç§’ï¼ˆä¸»è¦æ˜¯IOæ—¶é—´ï¼‰

# 3. å†…å­˜ä½¿ç”¨
go test -bench=. -benchmem ./internal/logger/... | grep "allocs/op"
# é¢„æœŸ: <100 B/op, <5 allocs/op

# 4. å¯¹æ¯”åŸºå‡†ï¼ˆå…³é”®æŒ‡æ ‡ä¸åº”ä¸‹é™ï¼‰
benchcmp old_bench.txt new_bench.txt
# é¢„æœŸ: 
#   - logger.Info: æŒå¹³æˆ–æå‡
#   - UIæ¸²æŸ“: æå‡90%ï¼ˆå»é‡æ•ˆæœï¼‰
#   - ä¸‹è½½é€Ÿåº¦: æŒå¹³ï¼ˆIO boundä¸å—å½±å“ï¼‰
```

**è‡ªåŠ¨åŒ–CI**ï¼š
- [ ] GitHub Actionsé›†æˆæµ‹è¯•
- [ ] è‡ªåŠ¨è¿è¡Œraceæ£€æµ‹
- [ ] è‡ªåŠ¨æ€§èƒ½å›å½’æ£€æµ‹
- [ ] ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

---

## ğŸ§ª äº”ã€é£é™©ä¸å›æ»šç­–ç•¥

| é£é™©é¡¹        | å½±å“ | æ¦‚ç‡ | ç¼“è§£ç­–ç•¥                                           | å›æ»šæ–¹æ¡ˆ                |
| ---------- | -- | -- | ---------------------------------------------- | ------------------- |
| æ€§èƒ½ä¸‹é™       | é«˜  | ä½  | â€¢ æ¯ä¸ªPhaseå®Œæˆåè¿è¡Œbenchmarkå¯¹æ¯”<br>â€¢ å®æ—¶ç›‘æ§CPU/å†…å­˜å ç”¨      | ä¿ç•™æ€§èƒ½åŸºå‡†æ•°æ®ï¼Œå›é€€åˆ°ä¸Šä¸€é˜¶æ®µ    |
| è¾“å‡ºæ··ä¹±       | ä¸­  | ä½  | â€¢ ä¿ç•™ `core.SafePrintf` å‘åå…¼å®¹<br>â€¢ diffæµ‹è¯•éªŒè¯è¾“å‡ºä¸€è‡´æ€§ | åˆ‡æ¢å›å…¼å®¹å±‚              |
| å¹¶å‘bug      | é«˜  | ä¸­  | â€¢ æ¯æ¬¡æäº¤å‰è¿è¡Œ `-race` æµ‹è¯•<br>â€¢ å‹åŠ›æµ‹è¯•ï¼ˆ-count=100ï¼‰    | å®šä½å…·ä½“é”é—®é¢˜ï¼Œå¿«é€Ÿä¿®å¤        |
| æ ¼å¼ä¸å…¼å®¹      | ä¸­  | ä½  | â€¢ è¾“å‡ºç»“æœdiffå¯¹æ¯”æµ‹è¯•<br>â€¢ æ‰‹åŠ¨å›å½’æµ‹è¯•                      | è°ƒæ•´æ ¼å¼åŒ–é€»è¾‘             |
| Phase 2é‡æ„å¤æ‚ | é«˜  | ä¸­  | â€¢ **ä½¿ç”¨é€‚é…å™¨æ¨¡å¼è¿‡æ¸¡**<br>â€¢ é€æ­¥è¿ç§»ï¼Œä¸ä¸€æ¬¡æ€§æ”¹å…¨éƒ¨              | é€‚é…å™¨å…è®¸éƒ¨åˆ†å›é€€           |
| æ—¶é—´è¶…æœŸ       | ä½  | ä¸­  | â€¢ ä¼˜å…ˆå®ŒæˆMVP (Phase 1+2)<br>â€¢ Phase 3å¯åç»­è¿­ä»£       | æŒ‰MVPäº¤ä»˜ï¼Œé«˜çº§åŠŸèƒ½å»¶å       |
| ä»£ç å†²çª       | ä½  | ä¸­  | â€¢ å°æ­¥æäº¤ï¼Œé¢‘ç¹åˆå¹¶ä¸»åˆ†æ”¯<br>â€¢ ä»£ç å®¡æŸ¥                       | git rebaseè§£å†³        |
| å›æ»šéœ€è¦       | ä½  | ä½  | â€¢ ä¿ç•™ `feature/ui-refactor` åˆ†æ”¯<br>â€¢ ä¸»åˆ†æ”¯æ‰“tagå¤‡ä»½    | `git revert` æˆ–åˆ‡æ¢å›tag |

### è¯¦ç»†å›æ»šç­–ç•¥

#### 1. åˆ†é˜¶æ®µæ ‡è®°ï¼ˆTaggingï¼‰

```bash
# é‡æ„å¼€å§‹å‰
git tag v2.5.3-pre-refactor
git push origin v2.5.3-pre-refactor

# Phase 1 å®Œæˆ
git tag v2.6.0-phase1-logger
git push origin v2.6.0-phase1-logger

# Phase 2 å®Œæˆ
git tag v2.6.0-phase2-ui-decouple
git push origin v2.6.0-phase2-ui-decouple

# MVP å®Œæˆ
git tag v2.6.0-mvp
git push origin v2.6.0-mvp
```

#### 2. ç´§æ€¥å›æ»šæµç¨‹

```bash
# åœºæ™¯A: Phase 1å‡ºç°ä¸¥é‡é—®é¢˜
git revert HEAD~5..HEAD  # å›é€€æœ€è¿‘5æ¬¡æäº¤
# æˆ–
git reset --hard v2.5.3-pre-refactor
git push -f origin feature/ui-refactor  # ä»…åœ¨featureåˆ†æ”¯æ“ä½œ

# åœºæ™¯B: Phase 2æŸä¸ªå­æ¨¡å—æœ‰é—®é¢˜ï¼ˆä½¿ç”¨é€‚é…å™¨çš„ä¼˜åŠ¿ï¼‰
# ä¸éœ€è¦å…¨éƒ¨å›æ»šï¼Œåªéœ€ï¼š
git revert <æœ‰é—®é¢˜çš„commit>
# é€‚é…å™¨å±‚ä¿è¯å…¶ä»–éƒ¨åˆ†ç»§ç»­å·¥ä½œ

# åœºæ™¯C: æ€§èƒ½å›é€€
# 1. è¿è¡Œæ€§èƒ½å¯¹æ¯”
benchcmp old_bench.txt new_bench.txt
# 2. å®šä½æ€§èƒ½ç“¶é¢ˆ
go test -cpuprofile=cpu.prof -bench=.
go tool pprof -top cpu.prof
# 3. é’ˆå¯¹æ€§ä¼˜åŒ–ï¼Œè€Œéæ•´ä½“å›æ»š
```

#### 3. å…¼å®¹æ€§ä¿é™©ç­–ç•¥

```go
// internal/core/output.go
// ä¿ç•™æ—§æ¥å£ä½œä¸ºå…¼å®¹å±‚ï¼ˆè‡³å°‘ä¿ç•™2ä¸ªç‰ˆæœ¬ï¼‰

// æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä½†ä»ç„¶å¯ç”¨
// Deprecated: ä½¿ç”¨ logger.Info() æ›¿ä»£
func SafePrintf(format string, a ...interface{}) {
    logger.Info(format, a...)
}

// ç¯å¢ƒå˜é‡æ§åˆ¶æ˜¯å¦å¯ç”¨æ–°ç³»ç»Ÿ
var useNewLogger = os.Getenv("USE_NEW_LOGGER") != "false"  // é»˜è®¤å¯ç”¨

func logMessage(msg string) {
    if useNewLogger {
        logger.Info(msg)
    } else {
        // é™çº§åˆ°æ—§å®ç°
        OutputMutex.Lock()
        fmt.Println(msg)
        OutputMutex.Unlock()
    }
}
```

#### 4. éªŒè¯æ£€æŸ¥ç‚¹ï¼ˆæ¯ä¸ªé˜¶æ®µå®Œæˆåæ‰§è¡Œï¼‰

```bash
#!/bin/bash
# scripts/validate_refactor.sh

echo "ğŸ” éªŒè¯é‡æ„å®‰å…¨æ€§..."

# 1. ç¼–è¯‘æ£€æŸ¥
go build -o apple-music-downloader || { echo "âŒ ç¼–è¯‘å¤±è´¥"; exit 1; }

# 2. å•å…ƒæµ‹è¯•
go test ./... || { echo "âŒ å•å…ƒæµ‹è¯•å¤±è´¥"; exit 1; }

# 3. Raceæ£€æµ‹
go test -race ./... || { echo "âŒ Raceæ£€æµ‹å¤±è´¥"; exit 1; }

# 4. åŠŸèƒ½æµ‹è¯•ï¼ˆä½¿ç”¨æµ‹è¯•æ•°æ®ï¼‰
./apple-music-downloader test/test_album.txt || { echo "âŒ åŠŸèƒ½æµ‹è¯•å¤±è´¥"; exit 1; }

# 5. æ€§èƒ½å¯¹æ¯”
if [ -f "baseline_bench.txt" ]; then
    go test -bench=. ./... > new_bench.txt
    benchcmp baseline_bench.txt new_bench.txt || echo "âš ï¸  æ€§èƒ½æœ‰å˜åŒ–ï¼Œéœ€äººå·¥å®¡æŸ¥"
fi

echo "âœ… æ‰€æœ‰éªŒè¯é€šè¿‡ï¼"
```

---

## ğŸ§± äº”ã€æœ€ç»ˆäº¤ä»˜æˆæœ

| æ¨¡å—                  | æ–°ç›®å½•ç»“æ„        |
| ------------------- | ------------ |
| `internal/logger`   | æ—¥å¿—å°è£…å±‚ï¼ˆå«æ–‡ä»¶è¾“å‡ºï¼‰ |
| `internal/progress` | è¿›åº¦äº‹ä»¶è°ƒåº¦ä¸­å¿ƒ     |
| `internal/ui`       | åŠ¨æ€UIä¸ç›‘å¬å™¨     |
| `internal/core`     | çŠ¶æ€æ•°æ®ä¸å…¼å®¹å±‚     |

---

## âœ… å…­ã€é‡Œç¨‹ç¢‘ä¸å‘å¸ƒè®¡åˆ’

æœ¬æ–¹æ¡ˆä¸º**æ¸è¿›å¼ã€æœ€å°å…¥ä¾µ**é‡æ„æ–¹æ¡ˆï¼Œå…¼é¡¾å®‰å…¨ä¸å¯æ‰©å±•æ€§ã€‚

### MVPæ–¹æ¡ˆå‘¨æœŸï¼š**4-5å‘¨**
### å®Œæ•´æ–¹æ¡ˆå‘¨æœŸï¼š**6-8å‘¨**

### é‡Œç¨‹ç¢‘è§„åˆ’

| é‡Œç¨‹ç¢‘           | æ—¶é—´èŠ‚ç‚¹   | å†…å®¹                        | åˆå¹¶æ¡ä»¶                                            | å‘å¸ƒç‰ˆæœ¬          |
| ------------- | ------ | ------------------------- | ----------------------------------------------- | ------------- |
| **M0: åŸºçº¿å»ºç«‹**  | Week 0 | â€¢ åˆ›å»ºfeatureåˆ†æ”¯<br>â€¢ æ‰“åŸºçº¿tag | â€¢ æ‰€æœ‰æµ‹è¯•é€šè¿‡<br>â€¢ æ€§èƒ½åŸºå‡†ä¿å­˜                            | `v2.5.3`      |
| **M1: æ—¥å¿—é‡æ„**  | Week 2 | â€¢ loggeræ¨¡å—å®Œæˆ<br>â€¢ fmt.Printæ›¿æ¢ | â€¢ æ—¥å¿—æµ‹è¯•è¦†ç›–ç‡ >80%<br>â€¢ Raceæµ‹è¯•é€šè¿‡<br>â€¢ æ€§èƒ½æŒå¹³æˆ–æå‡        | `v2.6.0-rc1`  |
| **M2: UIè§£è€¦**  | Week 5 | â€¢ progressæ¨¡å—å®Œæˆ<br>â€¢ UIäº‹ä»¶é©±åŠ¨ | â€¢ ä¸‹è½½å™¨ä¸UIè§£è€¦<br>â€¢ UIæ›´æ–°ç¨³å®š<br>â€¢ è¾“å‡ºä¸€è‡´æ€§æµ‹è¯•é€šè¿‡<br>â€¢ æ€§èƒ½æå‡90% | `v2.6.0-rc2`  |
| **M3: MVPäº¤ä»˜** | Week 6 | â€¢ åŸºç¡€æµ‹è¯•å®Œæˆ<br>â€¢ æ–‡æ¡£æ›´æ–°       | â€¢ æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡<br>â€¢ æ‰‹åŠ¨å›å½’æµ‹è¯•é€šè¿‡<br>â€¢ æ€§èƒ½è¾¾æ ‡              | `v2.6.0` ğŸ¯   |
| **M4: å¢å¼ºåŠŸèƒ½**  | Week 8 | â€¢ æ—¥å¿—æ–‡ä»¶è¾“å‡º<br>â€¢ å¯æ’æ‹”UI       | â€¢ `--no-ui` æ¨¡å¼è¿è¡Œç¨³å®š<br>â€¢ å®Œæ•´æµ‹è¯•è¦†ç›–                   | `v2.7.0` (å¯é€‰) |

### å‘å¸ƒç­–ç•¥

#### v2.6.0-rc1ï¼ˆé‡Œç¨‹ç¢‘M1ï¼‰
**åŠŸèƒ½**ï¼š
- âœ… ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
- âœ… æ—¥å¿—ç­‰çº§æ§åˆ¶
- âœ… çº¿ç¨‹å®‰å…¨ä¿è¯

**éªŒè¯**ï¼š
```bash
# Alphaæµ‹è¯•ï¼ˆå†…éƒ¨ï¼‰
go test -race ./...
go test -bench=. ./internal/logger/...

# Betaæµ‹è¯•ï¼ˆå°èŒƒå›´ç”¨æˆ·ï¼‰
./apple-music-downloader test.txt --log-level=debug
```

#### v2.6.0-rc2ï¼ˆé‡Œç¨‹ç¢‘M2ï¼‰
**åŠŸèƒ½**ï¼š
- âœ… UIä¸ä¸‹è½½å™¨è§£è€¦
- âœ… äº‹ä»¶é©±åŠ¨è¿›åº¦æ›´æ–°
- âœ… UIæ€§èƒ½ä¼˜åŒ–ï¼ˆ90%æå‡ï¼‰

**éªŒè¯**ï¼š
```bash
# å®Œæ•´åŠŸèƒ½æµ‹è¯•
./scripts/validate_refactor.sh

# æ€§èƒ½å¯¹æ¯”
benchcmp v2.5.3_bench.txt v2.6.0-rc2_bench.txt
```

#### v2.6.0ï¼ˆé‡Œç¨‹ç¢‘M3 - MVPæ­£å¼å‘å¸ƒï¼‰ğŸ¯
**é‡å¤§æ”¹è¿›**ï¼š
- ğŸ‰ å½»åº•è§£å†³æ—¥å¿—ç«äº‰é—®é¢˜
- ğŸ‰ UIåˆ·æ–°æ€§èƒ½æå‡90%
- ğŸ‰ æ¶æ„æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§æå‡
- ğŸ‰ å…¨é¢é€šè¿‡å¹¶å‘å®‰å…¨æµ‹è¯•

**å‘å¸ƒæ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ >80%ï¼‰
- [ ] Raceæ£€æµ‹é›¶è­¦å‘Š
- [ ] æ€§èƒ½åŸºå‡†è¾¾æ ‡ï¼ˆè§Phase 4éªŒæ”¶æ ‡å‡†ï¼‰
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆï¼ˆREADME + CHANGELOGï¼‰
- [ ] è‡³å°‘10ä¸ªçœŸå®åœºæ™¯æµ‹è¯•
- [ ] å‘åå…¼å®¹æ€§éªŒè¯
- [ ] å‘å¸ƒè¯´æ˜å‡†å¤‡å°±ç»ª

#### v2.7.0ï¼ˆé‡Œç¨‹ç¢‘M4 - å¯é€‰å¢å¼ºï¼‰
**é«˜çº§åŠŸèƒ½**ï¼š
- ğŸ“ æ—¥å¿—æ–‡ä»¶è¾“å‡º
- ğŸ”Œ å¯æ’æ‹”UIï¼ˆæ”¯æŒ`--no-ui`ï¼‰
- ğŸ“Š ç»“æ„åŒ–æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

---

## FQA

éå¸¸å¥½çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ä½ åŸé¡¹ç›®é‡Œæœ€å…³é”®ã€æœ€ã€Œé¡½å›ºã€çš„ç—›ç‚¹ã€‚
âœ… ç®€çŸ­å›ç­”ï¼š**æ˜¯çš„ï¼Œè¿™å¥—é‡æ„æ–¹æ¡ˆæ˜¯ä¸“é—¨ä¸ºè§£å†³è¿™äº›é¡½å›ºé—®é¢˜è€Œè®¾è®¡çš„ï¼Œå¯ä»¥å½»åº•æŠ‘åˆ¶æ—¥å¿—ç«äº‰ä¸å™ªéŸ³é—®é¢˜ã€‚**

## ä¸‹é¢æˆ‘è¯¦ç»†è§£é‡Šå®ƒæ˜¯**å¦‚ä½•ä»æ ¹æœ¬ä¸Šè§£å†³è¿™å‡ ä¸ªå…·ä½“é—®é¢˜**çš„ã€‚

## ğŸ§¨ ä¸€ã€åŸé¡¹ç›®ä¸­ã€Œé¡½å›ºé—®é¢˜ã€çš„æœ¬è´¨

| é—®é¢˜ç°è±¡                    | æ ¹å› åˆ†æ                                                       |
| ----------------------- | ---------------------------------------------------------- |
| **æ—¥å¿—ä¸UIè¾“å‡ºç«äº‰**ï¼ˆæ–‡å­—é—ªçƒã€è¡Œé”™ä½ï¼‰ | `fmt.Printf`ã€`SafePrintf`ã€`RenderUI` åŒæ—¶å†™ `stdout`ï¼Œå½¼æ­¤æ— è°ƒåº¦ç­–ç•¥ã€‚ |
| **æ—¥å¿—å™ªéŸ³è¿‡å¤š**ï¼ˆè¿›åº¦é‡å¤æ‰“å°ã€çŠ¶æ€åˆ·å±ï¼‰ | UIåˆ·æ–°ä¸æ—¥å¿—è¾“å‡ºæ··åœ¨åŒä¸€é€šé“ä¸­ï¼Œè¿›åº¦chané«˜é¢‘è§¦å‘ã€‚                               |
| **ç»ˆç«¯æ˜¾ç¤ºç´Šä¹±**ï¼ˆæ—¥å¿—ç©¿æ’åœ¨UIä¹‹ä¸­ï¼‰   | è¾“å‡ºå±‚æœªåˆ†ç¦»ï¼Œæ—¥å¿—ç›´æ¥å½±å“ANSIæ¸²æŸ“åŒºåŸŸã€‚                                     |
| **æ— æ³•é™é»˜è¿è¡Œ**ï¼ˆè°ƒè¯•ä¿¡æ¯å¤ªå¤šï¼‰      | æ— æ—¥å¿—ç­‰çº§åŒºåˆ†ï¼›æ— æ³•å…³é—­INFOæˆ–DEBUGçº§åˆ«è¾“å‡ºã€‚                                |
| **ç«äº‰é£é™©ï¼ˆraceï¼‰**          | å¤šå¤„å¯¹stdoutè¿›è¡Œé”ç²’åº¦ä¸åŒçš„å¹¶å‘å†™å…¥ã€‚                                     |

è¿™äº›é—®é¢˜åœ¨ä½ çš„åˆ†ææ–‡æ¡£ä¸­å·²ç»è¢«éå¸¸å‡†ç¡®åœ°æŒ‡å‡ºï¼Œä¾‹å¦‚ï¼š

> * â€œfmt.Print ç›´æ¥ä½¿ç”¨122æ¬¡ç»•è¿‡SafePrintfâ€
> * â€œUIä¸æ—¥å¿—ç³»ç»Ÿå…±ç”¨ OutputMutexï¼Œå¯¼è‡´åˆ·æ–°å»¶è¿Ÿä¸æ­»é”é£é™©â€
> * â€œå»é‡é€»è¾‘æœªåœ¨æ‰€æœ‰é˜¶æ®µç”Ÿæ•ˆï¼Œ100%ä¸‹è½½ä»é‡å¤è¾“å‡º20+æ¬¡â€

---

## ğŸ§© äºŒã€é‡æ„æ–¹æ¡ˆå¦‚ä½•é€å±‚è§£å†³è¿™äº›é—®é¢˜

### ğŸ§± 1ï¸âƒ£ æ—¥å¿—ä¸UIè¾“å‡ºå½»åº•åˆ†ç¦»

**æ ¸å¿ƒæªæ–½ï¼šç‹¬ç«‹è¾“å‡ºé€šé“ + ç‹¬ç«‹é” + ä¸åŒæ¸²æŸ“ç›®æ ‡**

| é¡¹ç›®   | åŸè®¾è®¡                | é‡æ„å                                      |
| ---- | ------------------ | ---------------------------------------- |
| è¾“å‡ºé”  | `OutputMutex` å…¨å±€äº’æ–¥ | `logger.mu` ä¸ `ui.UiMutex` åˆ†ç¦»            |
| è¾“å‡ºç›®æ ‡ | åŒä¸º `os.Stdout`     | logger â†’ `stderr` / `file`ï¼›UI â†’ `stdout` |
| å†™å…¥æ–¹å¼ | ç›´æ¥fmt.Print        | `logger.Info()` ç»Ÿä¸€å°è£…                     |
| åŒæ­¥æ–¹å¼ | ç«äº‰æ‰“å°               | é€šé“åŒ–å¼‚æ­¥å†™å…¥                                  |

**ç»“æœï¼š**

* å³ä½¿ UI æ­£åœ¨åˆ·æ–°ï¼Œæ—¥å¿—å†™å…¥ä¹Ÿä¸ä¼šæ‰“æ–­ç»ˆç«¯æ¸²æŸ“ã€‚
* ç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢ä¸å†é—ªçƒæˆ–è¢«æ—¥å¿—ã€Œç©¿é€ã€ã€‚
* å¯é€‰æ‹©å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼ˆå½»åº•é™é»˜UIï¼‰ã€‚

---

### ğŸ§± 2ï¸âƒ£ å¼•å…¥æ—¥å¿—ç­‰çº§è¿‡æ»¤ï¼Œå±è”½å™ªéŸ³

```go
logger.SetLevel(logger.WARN)
```

å³å¯åœ¨æ§åˆ¶å°ä¸­åªæ˜¾ç¤ºé‡è¦ä¿¡æ¯ã€‚
åŸæœ¬é«˜é¢‘çš„ â€œä¸‹è½½ä¸­ 56%â€ / â€œè§£å¯†å®Œæˆâ€ ç­‰è¾“å‡ºå°†è¢«æ‹¦æˆªã€‚

| çº§åˆ«    | è¾“å‡ºç›®æ ‡     | ä½¿ç”¨åœºæ™¯    |
| ----- | -------- | ------- |
| DEBUG | æ–‡ä»¶æ—¥å¿—     | è°ƒè¯•æ€§èƒ½ã€è¯Šæ–­ |
| INFO  | æ§åˆ¶å°      | ç”¨æˆ·æç¤º    |
| WARN  | æ§åˆ¶å°      | æ½œåœ¨é—®é¢˜    |
| ERROR | æ§åˆ¶å° + æ–‡ä»¶ | é”™è¯¯æŠ¥å‘Š    |

**æ•ˆæœï¼š**

* ã€Œå™ªéŸ³ã€ä¿¡æ¯ï¼ˆé¢‘ç¹çš„è¿›åº¦æç¤ºï¼‰é»˜è®¤ä¸å†åˆ·å±ï¼›
* æƒ³è°ƒè¯•æ—¶å†æ‰‹åŠ¨å‡çº§ `DEBUG`ï¼›
* ä¸åŒæ¨¡å¼ï¼ˆUIæ¨¡å¼/æ— UIæ¨¡å¼ï¼‰å¯åˆ‡æ¢è¾“å‡ºç­‰çº§ã€‚

---

### ğŸ§± 3ï¸âƒ£ UIæ”¹ä¸ºäº‹ä»¶é©±åŠ¨ï¼ˆéé¢‘ç¹åˆ·æ–°ï¼‰

åŸè®¾è®¡ï¼š

```go
RenderUI() æ¯300msåˆ·æ–°
```

å³ä½¿çŠ¶æ€æ²¡å˜åŒ–ä¹Ÿä¼šä¸æ–­æ‰“å°ï¼Œå½¢æˆâ€œUIé£æš´â€ã€‚

é‡æ„åé‡‡ç”¨ï¼š

```go
ui.OnProgress(event progress.ProgressEvent)
```

â†’ ä»…åœ¨çŠ¶æ€**å®é™…å˜åŒ–**æ—¶æ¸²æŸ“ã€‚

å†åŠ ä¸Š dedup é€»è¾‘ï¼š

```go
if core.TrackStatuses[i].Status == status {
    return  // è·³è¿‡ç›¸åŒçŠ¶æ€
}
```

**ç»“æœï¼š**

* UIåˆ·æ–°é¢‘ç‡é™ä½90%ä»¥ä¸Šï¼›
* ä¸‹è½½å®Œæˆé˜¶æ®µä¸ä¼šåå¤æ˜¾ç¤º100%ï¼›
* CPUå ç”¨é™ä½ã€è§†è§‰å¹²å‡€ã€‚

---

### ğŸ§± 4ï¸âƒ£ ç‹¬ç«‹çš„æ—¥å¿—ç¼“å†²å†™å…¥ï¼ˆé˜²æ­¢ç«äº‰IOï¼‰

Loggerä¸­æ¯æ¬¡å†™æ“ä½œéƒ½æœ‰å†…éƒ¨é”ä¿æŠ¤ï¼š

```go
func (l *DefaultLogger) log(level LogLevel, format string, args ...interface{}) {
    l.mu.Lock()
    defer l.mu.Unlock()
    fmt.Fprintf(l.output, prefix+format+"\n", args...)
}
```

* **ä¸ä¾èµ–å…¨å±€mutex**ï¼ˆè§£å†³é”ç²’åº¦ä¸ä¸€è‡´é—®é¢˜ï¼‰ï¼›
* **å•ä¸€writeråŸå­æ€§å†™å…¥**ï¼ˆé˜²æ­¢æ—¥å¿—è¢«åˆ‡å‰²ï¼‰ï¼›
* **UIæ¸²æŸ“é”ä¸æ—¥å¿—é”äº’ä¸å¹²æ‰°**ï¼ˆæ¶ˆé™¤è¾“å‡ºä¹±åºï¼‰ã€‚

---

### ğŸ§± 5ï¸âƒ£ å¯é€‰ã€Œé™é»˜è¿è¡Œæ¨¡å¼ã€

åœ¨é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œä¸­æ·»åŠ ï¼š

```yaml
logging:
  level: error
  output: amdl.log
  show_timestamp: true
```

æˆ–å‘½ä»¤è¡Œï¼š

```bash
./apple-music-downloader --no-ui --quiet
```

æ•ˆæœï¼š

* ç»ˆç«¯æ— ä»»ä½•å®æ—¶è¾“å‡ºï¼›
* æ‰€æœ‰æ—¥å¿—å®‰å…¨å†™å…¥æ–‡ä»¶ï¼›
* å®Œå…¨æ— ANSIè¾“å‡ºå†²çªï¼›
* éäº¤äº’è¿è¡Œï¼ˆCIç¯å¢ƒï¼‰å®Œå…¨å®‰é™ã€‚

---

## ğŸ”§ ä¸‰ã€ç»“æœå¯¹æ¯”ç¤ºæ„

| åœºæ™¯          | é‡æ„å‰         | é‡æ„å         |
| ----------- | ----------- | ----------- |
| å¹¶å‘ä¸‹è½½20é¦–     | æ§åˆ¶å°è¡Œé—ªçƒã€çŠ¶æ€ç©¿æ’ | è¡Œç¨³å®šï¼ŒçŠ¶æ€ç‹¬ç«‹åˆ·æ–°  |
| DEBUGæ¨¡å¼     | æ§åˆ¶å°å™ªéŸ³ä¸¥é‡     | ä»…æ–‡ä»¶è®°å½•ï¼Œæ§åˆ¶å°å¹²å‡€ |
| ä¸‹è½½100%å     | çŠ¶æ€åå¤æ‰“å°      | å»é‡ï¼Œæ— é‡å¤è¾“å‡º    |
| fmt.Printè°ƒç”¨ | 122å¤„ç«äº‰è¾“å‡º    | å…¨éƒ¨ç»Ÿä¸€åˆ°logger |
| UIæš‚åœæ—¶æ—¥å¿—å¹²æ‰°   | YES         | NOï¼ˆç‹¬ç«‹è¾“å‡ºæµï¼‰   |

---

## âš™ï¸ å››ã€é¢å¤–åŠ åˆ†ç‚¹

1. **æ”¯æŒæœªæ¥ Web UI æˆ– TUI æ›¿æ¢**ï¼šå› ä¸ºUIå±‚é€šè¿‡æ¥å£åŒ–ï¼Œä¸å†ä¾èµ–å…·ä½“stdoutï¼›
2. **å…¼å®¹æ€§å®‰å…¨**ï¼šæ—§ä»£ç  `SafePrintf` ä»ç„¶å¯ç”¨ï¼Œåªæ˜¯å†…éƒ¨è·³è½¬åˆ°loggerï¼›
3. **race-free**ï¼šä½¿ç”¨ `go test -race ./...` å¯å®Œå…¨æ£€æµ‹å¹¶é€šè¿‡ï¼›
4. **ä½æˆæœ¬è¿ç§»**ï¼šä¸éœ€è¦å¤§é¢ç§¯é‡å†™ä¸‹è½½å™¨é€»è¾‘ã€‚

---

## âœ… äº”ã€ç»“è®ºæ€»ç»“

| ç›®æ ‡         | çŠ¶æ€     | è¯´æ˜              |
| ---------- | ------ | --------------- |
| æ—¥å¿—ç«äº‰é—®é¢˜     | âœ… å½»åº•æ¶ˆé™¤ | è¾“å‡ºé€šé“éš”ç¦» + é”ä¿æŠ¤    |
| è¾“å‡ºæ··ä¹±       | âœ… æ¶ˆé™¤   | ç‹¬ç«‹stdout/stderr |
| æ—¥å¿—å™ªéŸ³       | âœ… æ˜¾è‘—æŠ‘åˆ¶ | æ—¥å¿—çº§åˆ«è¿‡æ»¤          |
| ä¸‹è½½100%é‡å¤æ‰“å° | âœ… ä¿®å¤   | UIå»é‡æœºåˆ¶          |
| æ€§èƒ½         | âœ… æå‡   | æ¸²æŸ“é¢‘ç‡é™ä½90%       |
| è°ƒè¯•å¯æ§       | âœ… æå‡   | é…ç½®åŒ–æ—¥å¿—ç­‰çº§         |

---

## ğŸš€ ä¸ƒã€å¿«é€Ÿå¯åŠ¨æŒ‡å—

### å‡†å¤‡å·¥ä½œï¼ˆWeek 0ï¼‰

```bash
# 1. åˆ›å»ºfeatureåˆ†æ”¯
git checkout -b feature/ui-refactor

# 2. ä¿å­˜å½“å‰æ€§èƒ½åŸºçº¿
go test -bench=. ./... > baseline_bench.txt

# 3. æ‰“tagä½œä¸ºå›æ»šç‚¹
git tag v2.5.3-pre-refactor
git push origin v2.5.3-pre-refactor

# 4. åˆ›å»ºæµ‹è¯•æ•°æ®
# å‡†å¤‡å‡ ä¸ªæµ‹è¯•ä¸“è¾‘/æ­Œæ›²çš„URLï¼Œä¿å­˜åˆ°test/ç›®å½•
mkdir -p test
echo "https://music.apple.com/..." > test/test_album.txt

# 5. è¿è¡Œä¸€æ¬¡å®Œæ•´æµ‹è¯•ä½œä¸ºåŸºå‡†
./apple-music-downloader test/test_album.txt > test/baseline_output.txt 2>&1
```

### Phase 1 å®æ–½æ­¥éª¤ï¼ˆWeek 1-2ï¼‰

#### Day 1-2: åˆ›å»ºloggeråŒ…

```bash
# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p internal/logger

# 2. å®ç°logger.goï¼ˆå‚è€ƒæ–¹æ¡ˆä¸­çš„ä»£ç ï¼‰
# internal/logger/logger.go
# internal/logger/logger_test.go
# internal/logger/logger_bench_test.go

# 3. è¿è¡Œæµ‹è¯•
go test ./internal/logger/...
go test -bench=. ./internal/logger/...
```

#### Day 3-4: æ›¿æ¢fmt.Print

```bash
# 1. å…ˆåœ¨main.goä¸­åˆå§‹åŒ–logger
# åœ¨mainå‡½æ•°å¼€å§‹å¤„æ·»åŠ :
# logger.SetLevel(logger.INFO)

# 2. åˆ›å»ºæ›¿æ¢è„šæœ¬
cat > scripts/replace_fmt_print.sh <<'EOF'
#!/bin/bash
# é€æ–‡ä»¶æ›¿æ¢ï¼Œé¿å…ä¸€æ¬¡æ€§æ”¹åŠ¨è¿‡å¤§

for file in $(find internal/ main.go utils/ -name "*.go" -not -path "*/vendor/*"); do
    echo "å¤„ç†: $file"
    # æ›¿æ¢fmt.Printfä¸ºlogger.Infoï¼ˆéœ€è¦æ‰‹åŠ¨å®¡æŸ¥ï¼‰
    # sed -i 's/fmt\.Printf(/logger.Info(/g' "$file"
    # æ³¨æ„ï¼šå®é™…æ‰§è¡Œæ—¶éœ€è¦ä»”ç»†æ£€æŸ¥æ¯ä¸€å¤„æ›¿æ¢
done
EOF

# 3. æ‰‹åŠ¨æ›¿æ¢å¹¶æµ‹è¯•ï¼ˆä¸è¦ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ï¼‰
# å»ºè®®ç­–ç•¥ï¼šæ¯æ¬¡æ›¿æ¢ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿è¡Œæµ‹è¯•
go test ./internal/core/...
git add internal/core/output.go
git commit -m "refactor(logger): æ›¿æ¢coreåŒ…ä¸­çš„fmt.Print"
```

#### Day 5-6: å…¼å®¹å±‚ä¸é…ç½®

```bash
# 1. æ›´æ–°configç»“æ„ä½“
# internal/core/config.go

# 2. æ›´æ–°config.yaml
cat >> config.yaml <<'EOF'

logging:
  level: info
  output: stdout
  show_timestamp: false
EOF

# 3. è¿è¡Œå®Œæ•´æµ‹è¯•
go test ./...
go test -race ./...
```

#### Day 7: Phase 1 éªŒæ”¶

```bash
# è¿è¡Œæ‰€æœ‰éªŒæ”¶æ£€æŸ¥ï¼ˆè§Phase 1éªŒæ”¶æ ‡å‡†ï¼‰
./scripts/validate_refactor.sh

# æ‰“tag
git tag v2.6.0-phase1-logger
git push origin feature/ui-refactor
git push origin v2.6.0-phase1-logger
```

### Phase 2 å®æ–½æ­¥éª¤ï¼ˆWeek 3-5ï¼‰

#### Week 3: åˆ›å»ºprogressåŒ…ä¸é€‚é…å™¨

```bash
# 1. åˆ›å»ºç›®å½•
mkdir -p internal/progress

# 2. å®ç°æ ¸å¿ƒæ¥å£
# internal/progress/progress.go - äº‹ä»¶å®šä¹‰ä¸é€šçŸ¥å™¨
# internal/progress/adapter.go - é€‚é…å™¨æ¨¡å¼
# internal/progress/progress_test.go

# 3. æµ‹è¯•
go test ./internal/progress/...
```

#### Week 4: å®ç°UIç›‘å¬å™¨

```bash
# 1. åœ¨uiåŒ…ä¸­æ·»åŠ ç›‘å¬å™¨
# internal/ui/listener.go

# 2. ä¿®æ”¹main.goæ³¨å†Œç›‘å¬å™¨
# main.goä¸­æ·»åŠ :
# notifier := progress.NewNotifier()
# notifier.AddListener(&ui.UIProgressListener{})

# 3. æµ‹è¯•UIç›‘å¬
go test ./internal/ui/...
```

#### Week 5: è¿ç§»ä¸‹è½½å™¨ï¼ˆä½¿ç”¨é€‚é…å™¨ï¼‰

```bash
# 1. é€ä¸ªè¿ç§»ä¸‹è½½å™¨æ¨¡å—
# ä¼˜å…ˆçº§: downloader.go -> runv14.go -> runv3.go

# 2. æ¯è¿ç§»ä¸€ä¸ªæ¨¡å—å°±æµ‹è¯•
go test ./internal/downloader/...
./apple-music-downloader test/test_album.txt

# 3. å®Œæ•´æµ‹è¯•
./scripts/validate_refactor.sh

# 4. æ‰“tag
git tag v2.6.0-phase2-ui-decouple
```

### Phase 4.1: åŸºç¡€æµ‹è¯•ï¼ˆWeek 6ï¼‰

```bash
# 1. æ·»åŠ é›†æˆæµ‹è¯•
# test/integration_test.sh

# 2. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
make ci

# 3. æ€§èƒ½å¯¹æ¯”
benchcmp baseline_bench.txt new_bench.txt

# 4. MVPå‘å¸ƒå‡†å¤‡
# æ›´æ–°CHANGELOG.md
# æ›´æ–°README.md
git tag v2.6.0
```

---

## ğŸ“ å…«ã€å®æ–½æœ€ä½³å®è·µ

### ä»£ç æäº¤è§„èŒƒ

ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯ï¼š

```bash
# åŠŸèƒ½å¼€å‘
git commit -m "feat(logger): æ·»åŠ æ—¥å¿—ç­‰çº§æ§åˆ¶"

# é‡æ„
git commit -m "refactor(ui): ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼è§£è€¦è¿›åº¦æ›´æ–°"

# ä¿®å¤
git commit -m "fix(logger): ä¿®å¤å¹¶å‘å†™å…¥raceé—®é¢˜"

# æµ‹è¯•
git commit -m "test(progress): æ·»åŠ é€šçŸ¥å™¨å•å…ƒæµ‹è¯•"

# æ–‡æ¡£
git commit -m "docs(refactor): æ›´æ–°é‡æ„æ–¹æ¡ˆæ–‡æ¡£"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "perf(ui): ä¼˜åŒ–UIåˆ·æ–°é¢‘ç‡ï¼Œæå‡90%æ€§èƒ½"
```

### å°æ­¥æäº¤ç­–ç•¥

```bash
# âœ… å¥½çš„åšæ³•ï¼šæ¯å®Œæˆä¸€ä¸ªå°åŠŸèƒ½å°±æäº¤
git add internal/logger/logger.go
git commit -m "feat(logger): å®ç°åŸºç¡€Loggeræ¥å£"

git add internal/logger/logger_test.go
git commit -m "test(logger): æ·»åŠ æ—¥å¿—ç­‰çº§æµ‹è¯•"

git add internal/core/output.go
git commit -m "refactor(core): æ›´æ–°SafePrintfä½¿ç”¨logger"

# âŒ é¿å…çš„åšæ³•ï¼šä¸€æ¬¡æ€§æäº¤å¤§é‡æ”¹åŠ¨
git add .
git commit -m "é‡æ„æ—¥å¿—å’ŒUI"  # å¤ªç¬¼ç»Ÿï¼Œéš¾ä»¥å›æ»š
```

### æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰

```bash
# 1. å…ˆå†™æµ‹è¯•
# internal/logger/logger_test.go

# 2. è¿è¡Œæµ‹è¯•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
go test ./internal/logger/...
# FAIL

# 3. å®ç°ä»£ç 
# internal/logger/logger.go

# 4. å†æ¬¡è¿è¡Œæµ‹è¯•ï¼ˆåº”è¯¥é€šè¿‡ï¼‰
go test ./internal/logger/...
# PASS

# 5. é‡æ„ä¼˜åŒ–
# ä¼˜åŒ–ä»£ç ç»“æ„

# 6. ç¡®ä¿æµ‹è¯•ä»ç„¶é€šè¿‡
go test ./internal/logger/...
# PASS
```

### æ€§èƒ½ç›‘æ§ä¹ æƒ¯

```bash
# æ¯æ¬¡é‡è¦æ”¹åŠ¨åè¿è¡Œbenchmark
go test -bench=. ./internal/logger/... > current_bench.txt

# ä¸ä¸Šä¸€æ¬¡å¯¹æ¯”
benchcmp last_bench.txt current_bench.txt

# å¦‚æœæ€§èƒ½ä¸‹é™ï¼Œç«‹å³è°ƒæŸ¥
# ä½¿ç”¨pprofåˆ†æ
go test -cpuprofile=cpu.prof -bench=.
go tool pprof -top cpu.prof
```

### ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

æ¯æ¬¡æäº¤PRå‰æ£€æŸ¥ï¼š

- [ ] ä»£ç éµå¾ªGoè¯­è¨€è§„èŒƒ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ`go test ./...`ï¼‰
- [ ] Raceæ£€æµ‹é€šè¿‡ï¼ˆ`go test -race ./...`ï¼‰
- [ ] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™ï¼ˆ`benchcmp`ï¼‰
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°æ˜ç¡®
- [ ] æ²¡æœ‰é—ç•™çš„debugä»£ç 
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•

#### é™·é˜±1ï¼šä¸€æ¬¡æ€§æ”¹åŠ¨è¿‡å¤§

```bash
# âŒ é”™è¯¯åšæ³•
# ä¸€æ¬¡æ€§æ›¿æ¢å…¨éƒ¨fmt.Printï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œéš¾ä»¥å®šä½é—®é¢˜

# âœ… æ­£ç¡®åšæ³•
# é€æ–‡ä»¶æ›¿æ¢ï¼Œæ¯æ¬¡æ›¿æ¢åç«‹å³æµ‹è¯•
for file in internal/core/*.go; do
    # æ›¿æ¢ä¸€ä¸ªæ–‡ä»¶
    # è¿è¡Œæµ‹è¯•
    go test ./internal/core/...
    # é€šè¿‡åå†æäº¤
    git add "$file"
    git commit -m "refactor(core): æ›¿æ¢$(basename $file)ä¸­çš„fmt.Print"
done
```

#### é™·é˜±2ï¼šå¿½è§†å‘åå…¼å®¹

```bash
# âŒ é”™è¯¯åšæ³•
# ç›´æ¥åˆ é™¤æ—§çš„SafePrintfå‡½æ•°

# âœ… æ­£ç¡®åšæ³•
# ä¿ç•™æ—§æ¥å£ï¼Œæ ‡è®°ä¸ºåºŸå¼ƒ
// Deprecated: ä½¿ç”¨ logger.Info() æ›¿ä»£
func SafePrintf(format string, a ...interface{}) {
    logger.Info(format, a...)
}
```

#### é™·é˜±3ï¼šæ€§èƒ½æµ‹è¯•ä¸å……åˆ†

```bash
# âŒ é”™è¯¯åšæ³•
# åªåœ¨å¼€å‘æœºä¸Šæµ‹è¯•ä¸€æ¬¡

# âœ… æ­£ç¡®åšæ³•
# å¤šåœºæ™¯ã€å¤šæ¬¡æµ‹è¯•
go test -bench=. -count=5 ./...  # è¿è¡Œ5æ¬¡å–å¹³å‡
go test -bench=. -cpu=1,2,4,8 ./...  # æµ‹è¯•ä¸åŒCPUæ ¸å¿ƒæ•°
```

### è°ƒè¯•æŠ€å·§

#### ä½¿ç”¨delveè°ƒè¯•å¹¶å‘é—®é¢˜

```bash
# å®‰è£…delve
go install github.com/go-delve/delve/cmd/dlv@latest

# è°ƒè¯•æµ‹è¯•
dlv test ./internal/logger/...

# è®¾ç½®æ–­ç‚¹
(dlv) break logger.go:42
(dlv) continue

# æŸ¥çœ‹goroutine
(dlv) goroutines
```

#### ä½¿ç”¨race detectorå®šä½ç«äº‰

```bash
# è¿è¡Œraceæ£€æµ‹
go test -race ./... 2>&1 | tee race_report.txt

# åˆ†ææŠ¥å‘Š
# æ‰¾åˆ°WARNING: DATA RACEè¡Œ
# æŸ¥çœ‹è¯»å†™ä½ç½®å’Œgoroutineæ ˆ

# ä¿®å¤åå†æ¬¡éªŒè¯
go test -race -count=100 ./internal/logger/...
```

---

## ğŸ’¡ ä¹ã€å…³é”®å†³ç­–ç‚¹ä¸å»ºè®®

### å†³ç­–1ï¼šæ˜¯å¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Ÿ

**é€‰é¡¹Aï¼šè‡ªå®ç°Loggerï¼ˆå½“å‰æ–¹æ¡ˆï¼‰**
- âœ… è½»é‡çº§ï¼Œæ— å¤–éƒ¨ä¾èµ–
- âœ… å®Œå…¨å¯æ§ï¼Œæ˜“äºå®šåˆ¶
- âœ… å­¦ä¹ æˆæœ¬ä½
- âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•

**é€‰é¡¹Bï¼šä½¿ç”¨logrus/zap**
- âœ… åŠŸèƒ½å¼ºå¤§ï¼ˆç»“æ„åŒ–æ—¥å¿—ã€é’©å­ç­‰ï¼‰
- âœ… æ€§èƒ½ä¼˜ç§€ï¼ˆzapï¼‰
- âŒ å¢åŠ ä¾èµ–
- âŒ å­¦ä¹ æˆæœ¬é«˜

**å»ºè®®**ï¼šMVPé˜¶æ®µä½¿ç”¨è‡ªå®ç°ï¼ŒPhase 3å¯é€‰å‡çº§åˆ°zapã€‚

### å†³ç­–2ï¼šé€‚é…å™¨æ¨¡å¼ vs ç›´æ¥é‡å†™ï¼Ÿ

**é€‰é¡¹Aï¼šä½¿ç”¨é€‚é…å™¨ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰** âœ…
- âœ… é£é™©ä½ï¼Œå¯é€æ­¥è¿ç§»
- âœ… å‡ºé—®é¢˜æ˜“å›æ»š
- âœ… æ–°æ—§ä»£ç å¯å…±å­˜
- âŒ å¢åŠ å°‘é‡ä»£ç 

**é€‰é¡¹Bï¼šç›´æ¥é‡å†™**
- âœ… ä»£ç æ›´ç®€æ´
- âŒ é£é™©é«˜ï¼Œä¸€æ¬¡æ€§æ”¹åŠ¨å¤§
- âŒ éš¾ä»¥å®šä½é—®é¢˜

**å»ºè®®**ï¼šå¼ºçƒˆæ¨èä½¿ç”¨é€‚é…å™¨ã€‚

### å†³ç­–3ï¼šä½•æ—¶ç§»é™¤å…¼å®¹å±‚ï¼Ÿ

**å»ºè®®æ—¶é—´çº¿**ï¼š
- v2.6.0: ä¿ç•™å…¼å®¹å±‚ï¼Œæ ‡è®°ä¸ºDeprecated
- v2.7.0: ç»§ç»­ä¿ç•™ï¼Œæ·»åŠ deprecationè­¦å‘Š
- v2.8.0: å¯è€ƒè™‘ç§»é™¤ï¼ˆè‡³å°‘é—´éš”2ä¸ªå¤§ç‰ˆæœ¬ï¼‰

```go
// v2.6.0
// Deprecated: ä½¿ç”¨ logger.Info() æ›¿ä»£
func SafePrintf(format string, a ...interface{}) {
    logger.Info(format, a...)
}

// v2.7.0
// Deprecated: ä½¿ç”¨ logger.Info() æ›¿ä»£ï¼Œå°†åœ¨v2.8.0ç§»é™¤
func SafePrintf(format string, a ...interface{}) {
    logger.Warn("SafePrintf is deprecated, use logger.Info()")
    logger.Info(format, a...)
}

// v2.8.0
// ç§»é™¤SafePrintf
```

---

## ğŸ“š åã€å‚è€ƒæ¸…å•

### å¿…è¯»èµ„æº

- [Effective Go - å¹¶å‘](https://go.dev/doc/effective_go#concurrency)
- [Goå¹¶å‘æ¨¡å¼ï¼šç®¡é“å’Œå–æ¶ˆ](https://go.dev/blog/pipelines)
- [è§‚å¯Ÿè€…æ¨¡å¼](https://refactoring.guru/design-patterns/observer/go/example)

### æ¨èå·¥å…·

| å·¥å…· | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|-----|------|---------|
| golangci-lint | ä»£ç æ£€æŸ¥ | `go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest` |
| benchcmp | æ€§èƒ½å¯¹æ¯” | `go get -u golang.org/x/tools/cmd/benchcmp` |
| delve | è°ƒè¯•å™¨ | `go install github.com/go-delve/delve/cmd/dlv@latest` |
| pprof | æ€§èƒ½åˆ†æ | Goå†…ç½® |

### é‡æ„å‰æ£€æŸ¥æ¸…å•

- [ ] å®Œæ•´é˜…è¯»æ¶æ„åˆ†ææ–‡æ¡£
- [ ] å®Œæ•´é˜…è¯»é‡æ„æ–¹æ¡ˆæ–‡æ¡£
- [ ] ç†è§£MVPä¸å®Œæ•´æ–¹æ¡ˆçš„åŒºåˆ«
- [ ] å‡†å¤‡å¥½æµ‹è¯•æ•°æ®
- [ ] ä¿å­˜æ€§èƒ½åŸºçº¿
- [ ] åˆ›å»ºfeatureåˆ†æ”¯
- [ ] æ‰“å›æ»štag
- [ ] å›¢é˜Ÿè¾¾æˆå…±è¯†

### æ¯æ—¥å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] è¿è¡Œ`go test ./...`
- [ ] è¿è¡Œ`go test -race ./...`
- [ ] æäº¤ä»£ç å‰code review
- [ ] ç¼–å†™æœ‰æ„ä¹‰çš„commit message
- [ ] æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
- [ ] æ›´æ–°è¿›åº¦åˆ°é‡Œç¨‹ç¢‘çœ‹æ¿

---

## ğŸ¯ åä¸€ã€æˆåŠŸæ ‡å‡†æ€»ç»“

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|-----|-------|---------|
| æ—¥å¿—æ€§èƒ½ | >1,000,000 ops/sec | `go test -bench=BenchmarkLogger` |
| UIåˆ·æ–°æ€§èƒ½ | æå‡90% | å¯¹æ¯”é‡æ„å‰ååˆ·æ–°æ¬¡æ•° |
| CPUå ç”¨ | <5% | `go tool pprof` |
| å†…å­˜åˆ†é… | <100 B/op | `go test -benchmem` |
| æµ‹è¯•è¦†ç›–ç‡ | >80% | `go test -cover` |
| Raceæ£€æµ‹ | 0è­¦å‘Š | `go test -race` |

### è´¨é‡æŒ‡æ ‡

- âœ… ä»£ç å¯è¯»æ€§æå‡ï¼ˆé€šè¿‡code reviewè¯„åˆ†ï¼‰
- âœ… æ¨¡å—è€¦åˆåº¦é™ä½ï¼ˆé€šè¿‡ä¾èµ–å›¾åˆ†æï¼‰
- âœ… æµ‹è¯•å¯ç»´æŠ¤æ€§æå‡ï¼ˆæµ‹è¯•ä»£ç è¡Œæ•°å‡å°‘ï¼‰
- âœ… æ–‡æ¡£å®Œæ•´æ€§ï¼ˆREADME + æ³¨é‡Šè¦†ç›–ï¼‰

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

- âœ… UIä¸å†é—ªçƒ
- âœ… ä¸‹è½½100%ä¸é‡å¤æ˜¾ç¤º
- âœ… é”™è¯¯ä¿¡æ¯æ¸…æ™°å¯è¯»
- âœ… æ”¯æŒé™é»˜è¿è¡Œæ¨¡å¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0ï¼ˆå·²æ•´åˆå¯è¡Œæ€§è¯„ä¼°åé¦ˆï¼‰  
**æœ€åæ›´æ–°**: 2025-10-10  
**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: å›¢é˜Ÿè¯„å®¡ â†’ ç¡®è®¤å¯åŠ¨ â†’ æ‰§è¡ŒPhase 1

---